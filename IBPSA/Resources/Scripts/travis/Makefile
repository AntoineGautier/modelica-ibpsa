############################################################
# Makefile for the regression tests that are run on travis
############################################################
ROOT = ../../../..

test-documentation:
	(cd $(ROOT)/IBPSA; ../bin/runUnitTests.py --validate-html-only)
	(cd $(ROOT)/IBPSA/Resources/src/fluid/heatpumps/calibration/doc; make regressiontest)

test-experiment-setup:
	(cd $(ROOT)/IBPSA; ../bin/runUnitTests.py --validate-experiment-setup)

test-autogenerated-files:
	# Check for package.order to be up to date
	(cd  $(ROOT)/IBPSA; \
	  python -c 'import buildingspy.development.refactor as r; \
	  r.write_package_order(".", recursive=True)'; \
	  git diff --exit-code . )

test-links-to-libraries:
	# Make sure there are no links to other libraries
	(cd  $(ROOT)/IBPSA; \
	  for wrongString in modelica://AixLib modelica://Buildings modelica://BuildingSystems modelica://IDEAS; do \
	    content=$(for ff in `find . -name '*.mo'`; do \
	      grep "${wrongString}" $ff; \
            done;) \
	    if [[ $(content) ]]; then \
	      echo "Error: Found files with invalid string ${wrongString}" \
	      exit 1 \
	   fi;\
          done; \
	)

test-dymola:
	(cd $(ROOT)/IBPSA && python ../bin/runUnitTests.py --batch --single-package $(PACKAGE) --tool dymola)

test-jmodelica:
	(cd $(ROOT)/IBPSA && python ../bin/runUnitTests.py --batch --single-package $(PACKAGE) --tool jmodelica --skip-verification)
